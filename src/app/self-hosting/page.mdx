import { defaultKeywords, defaultOpenGraph } from '../metadata'

export const metadata = {
  title: 'Self-Hosting',
  description: 'This guide explains how to self-host TofuPilot.',
  keywords: [
    ...defaultKeywords,
    'Self-Hosting',
    'TofuPilot Deployment',
    'Docker Setup',
    'On-Premise Installation',
    'Enterprise Hosting',
  ],
  openGraph: {
    ...defaultOpenGraph,
    title:
      'Self-Hosting - Deploy TofuPilot On-Premise | TofuPilot Documentation',
    description:
      'Learn how to self-host TofuPilot for on-premise deployment. Includes setup, authentication, and backup guidelines.',
    images: [
      {
        url: 'https://tofupilot.com/docs/self-hosting-header.png',
        width: 800,
        height: 600,
        alt: 'Self-hosting header showing TofuPilot deployed on a private server.',
      },
    ],
  },
}

# Self-Hosting: Prerequisites

Self-host TofuPilot for scenarios where managed cloud is not an option. {{ className: 'lead' }}

<Image
  src="/self-hosting-header.png"
  alt="Screenshot of TofuPilot application with custom url"
/>

## Overview

TofuPilot accounts are hosted on our AWS-powered cloud, managed by our team. This ensures strong security, high performance, automatic updates, and removes the need for your infrastructure management.

For strict IT policies or specific connectivity needs, TofuPilot can also be self-hosted.

## System Requirements

Ensure your server meets the minimum specifications.

| Requirement | Specification |
|-------------|----------------|
| **OS**      | Ubuntu 20.04 LTS or later (64-bit) |
| **CPU**     | 2 cores or more |
| **RAM**     | 4 GB or more |
| **Storage** | 20 GB of free disk space, or more depending on your run attachments needs |
| **Access**  | Sudo access to your server |
| **Network** | Open ports 80 (HTTP) and 443 (HTTPS) |

## Domains

Ensure your domain and DNS settings are prepared for self-hosting:

- **Domain Name**: Register a domain or subdomain for TofuPilot (e.g., `tofupilot.yourcompany.com`).
- **Storage Domain Name**: Register a subdomain for TofuPilot storage (e.g., `storage.tofupilot.yourcompany.com`).
- **DNS Records**: Create two A records in your DNS settings:
  - Point `tofupilot.yourcompany.com` to your server's public IPv4 address.
  - Point `storage.tofupilot.yourcompany.com` to the same public IPv4 address.
- **SSL Certificate**: Ensure you have a valid email address for registering the SSL certificate with Letâ€™s Encrypt.

## Authentication

TofuPilot does not store user passwords in its database and offers two secure methods for user sign-up and authentication:

1. **Email Authentication**: Users sign in by receiving a magic code sent to their email.
2. **OAuth Authentication**: Users sign in using their Microsoft or Google accounts.

You must enable **at least one** authentication method based on your requirements.

<Image
  src="/self-hosting-authentication.png"
  alt="Screenshot of TofuPilot Authentication page"
/>

### Email

To enable email-based authentication, retrieve the following SMTP server details:

- **SMTP Host**: The hostname of your email server (e.g., `smtp.yourdomain.com`).
- **SMTP Port**: Typically `587` for TLS or `465` for SSL.
- **Email From Address**: The email address that will send the magic codes (e.g., `auth@yourdomain.com`).
- **SMTP User**: The username for your email account (e.g., `auth@yourdomain.com`).
- **SMTP Password**: The password or app-specific password for your email account.

To enable OAuth authentication, create an authorized application in your Google or Microsoft account:

### Microsoft Entra ID OAuth

1. Go to the [Microsoft Entra admin center](https://entra.microsoft.com/).
2. Navigate to **Microsoft Entra ID** > Manage > **App registrations**.
3. Register a new application with these details:
   - **Redirect URI**: e.g. `https://tofupilot.yourcompany.com/api/auth/callback/microsoft-entra-id`
   - Set **Supported Account Types** to match your needs (e.g., single tenant or multi-tenant).
4. After registration, retrieve the following:
   - **Application (client) ID**
   - **Directory (tenant) ID**
   - **Client Secret**: Create a client secret under **Certificates & secrets**.

### Google OAuth

1. Go to the [Google Cloud Console](https://console.developers.google.com/apis/credentials).
2. Create a new OAuth 2.0 Client ID under **Credentials**.
3. Configure the following:
   - **Authorized Redirect URI**: `https://tofupilot.yourcompany.com/api/auth/callback/google`
4. Retrieve the following:
   - **Client ID**
   - **Client Secret**
